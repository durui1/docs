<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Spring Data JPA 的高级使用 | hemiao3000</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="Java Note All in One">
    
    <link rel="preload" href="/assets/css/0.styles.f47fbc3a.css" as="style"><link rel="preload" href="/assets/js/app.2a0e0086.js" as="script"><link rel="preload" href="/assets/js/2.5197d4bf.js" as="script"><link rel="preload" href="/assets/js/262.5d7edfe0.js" as="script"><link rel="prefetch" href="/assets/js/10.1e3cab56.js"><link rel="prefetch" href="/assets/js/100.89eb403f.js"><link rel="prefetch" href="/assets/js/101.42d7809e.js"><link rel="prefetch" href="/assets/js/102.1c8eb525.js"><link rel="prefetch" href="/assets/js/103.9b9587fa.js"><link rel="prefetch" href="/assets/js/104.e85d06e9.js"><link rel="prefetch" href="/assets/js/105.065aabba.js"><link rel="prefetch" href="/assets/js/106.c0bac4b5.js"><link rel="prefetch" href="/assets/js/107.a8264130.js"><link rel="prefetch" href="/assets/js/108.1477276e.js"><link rel="prefetch" href="/assets/js/109.88fbb61d.js"><link rel="prefetch" href="/assets/js/11.59a88738.js"><link rel="prefetch" href="/assets/js/110.bba6173c.js"><link rel="prefetch" href="/assets/js/111.34995448.js"><link rel="prefetch" href="/assets/js/112.3a469dd7.js"><link rel="prefetch" href="/assets/js/113.48b9f2fc.js"><link rel="prefetch" href="/assets/js/114.e0e063d3.js"><link rel="prefetch" href="/assets/js/115.eb7bf139.js"><link rel="prefetch" href="/assets/js/116.2189e21c.js"><link rel="prefetch" href="/assets/js/117.14be282d.js"><link rel="prefetch" href="/assets/js/118.99748a5e.js"><link rel="prefetch" href="/assets/js/119.e96e566b.js"><link rel="prefetch" href="/assets/js/12.298adfbe.js"><link rel="prefetch" href="/assets/js/120.384055c6.js"><link rel="prefetch" href="/assets/js/121.5ff8ea86.js"><link rel="prefetch" href="/assets/js/122.a0f0b033.js"><link rel="prefetch" href="/assets/js/123.77d612f1.js"><link rel="prefetch" href="/assets/js/124.1858235e.js"><link rel="prefetch" href="/assets/js/125.6088837a.js"><link rel="prefetch" href="/assets/js/126.f60cd78b.js"><link rel="prefetch" href="/assets/js/127.644059b1.js"><link rel="prefetch" href="/assets/js/128.ccde4b43.js"><link rel="prefetch" href="/assets/js/129.ea900aff.js"><link rel="prefetch" href="/assets/js/13.70824278.js"><link rel="prefetch" href="/assets/js/130.814ef2bd.js"><link rel="prefetch" href="/assets/js/131.0a15549e.js"><link rel="prefetch" href="/assets/js/132.5a483c59.js"><link rel="prefetch" href="/assets/js/133.f472519c.js"><link rel="prefetch" href="/assets/js/134.98724413.js"><link rel="prefetch" href="/assets/js/135.b1227763.js"><link rel="prefetch" href="/assets/js/136.569394ce.js"><link rel="prefetch" href="/assets/js/137.cb57c3ea.js"><link rel="prefetch" href="/assets/js/138.bf44da29.js"><link rel="prefetch" href="/assets/js/139.4d58dd61.js"><link rel="prefetch" href="/assets/js/14.2e6e5e48.js"><link rel="prefetch" href="/assets/js/140.9366ee37.js"><link rel="prefetch" href="/assets/js/141.f4b07b92.js"><link rel="prefetch" href="/assets/js/142.1135b70d.js"><link rel="prefetch" href="/assets/js/143.f4f7c551.js"><link rel="prefetch" href="/assets/js/144.39c67abd.js"><link rel="prefetch" href="/assets/js/145.d703b2bd.js"><link rel="prefetch" href="/assets/js/146.eb70e2fc.js"><link rel="prefetch" href="/assets/js/147.ce03361f.js"><link rel="prefetch" href="/assets/js/148.92d3943c.js"><link rel="prefetch" href="/assets/js/149.9863294e.js"><link rel="prefetch" href="/assets/js/15.da7ebcce.js"><link rel="prefetch" href="/assets/js/150.482dfaea.js"><link rel="prefetch" href="/assets/js/151.e10026cf.js"><link rel="prefetch" href="/assets/js/152.83952b99.js"><link rel="prefetch" href="/assets/js/153.7f3abc9c.js"><link rel="prefetch" href="/assets/js/154.8d6fe380.js"><link rel="prefetch" href="/assets/js/155.ee846f8c.js"><link rel="prefetch" href="/assets/js/156.30307bd5.js"><link rel="prefetch" href="/assets/js/157.cdd398ff.js"><link rel="prefetch" href="/assets/js/158.4fc1be51.js"><link rel="prefetch" href="/assets/js/159.3f8f4e04.js"><link rel="prefetch" href="/assets/js/16.32dbb119.js"><link rel="prefetch" href="/assets/js/160.8e328e24.js"><link rel="prefetch" href="/assets/js/161.1a1af511.js"><link rel="prefetch" href="/assets/js/162.c103da42.js"><link rel="prefetch" href="/assets/js/163.d9d38d65.js"><link rel="prefetch" href="/assets/js/164.e446e185.js"><link rel="prefetch" href="/assets/js/165.cee81e4f.js"><link rel="prefetch" href="/assets/js/166.2a838c3c.js"><link rel="prefetch" href="/assets/js/167.34bdc749.js"><link rel="prefetch" href="/assets/js/168.62adc13c.js"><link rel="prefetch" href="/assets/js/169.64528cc5.js"><link rel="prefetch" href="/assets/js/17.dd5dbf07.js"><link rel="prefetch" href="/assets/js/170.f4ff41c8.js"><link rel="prefetch" href="/assets/js/171.aebcc4a6.js"><link rel="prefetch" href="/assets/js/172.f941c291.js"><link rel="prefetch" href="/assets/js/173.0cb6857b.js"><link rel="prefetch" href="/assets/js/174.308fbfaa.js"><link rel="prefetch" href="/assets/js/175.1733770a.js"><link rel="prefetch" href="/assets/js/176.ffe8bb57.js"><link rel="prefetch" href="/assets/js/177.d61cf9c9.js"><link rel="prefetch" href="/assets/js/178.c676e6ad.js"><link rel="prefetch" href="/assets/js/179.021bd5b9.js"><link rel="prefetch" href="/assets/js/18.4c426f41.js"><link rel="prefetch" href="/assets/js/180.b6d56d9f.js"><link rel="prefetch" href="/assets/js/181.3e29a2f4.js"><link rel="prefetch" href="/assets/js/182.96c1421b.js"><link rel="prefetch" href="/assets/js/183.bfcdc6de.js"><link rel="prefetch" href="/assets/js/184.acb50183.js"><link rel="prefetch" href="/assets/js/185.2be24c25.js"><link rel="prefetch" href="/assets/js/186.8b6d56c2.js"><link rel="prefetch" href="/assets/js/187.83f09498.js"><link rel="prefetch" href="/assets/js/188.19f84a49.js"><link rel="prefetch" href="/assets/js/189.507b1b8f.js"><link rel="prefetch" href="/assets/js/19.a866d939.js"><link rel="prefetch" href="/assets/js/190.a7f35c31.js"><link rel="prefetch" href="/assets/js/191.44e116bb.js"><link rel="prefetch" href="/assets/js/192.7b3ad93e.js"><link rel="prefetch" href="/assets/js/193.3d7a6691.js"><link rel="prefetch" href="/assets/js/194.6b59737c.js"><link rel="prefetch" href="/assets/js/195.93da8eb6.js"><link rel="prefetch" href="/assets/js/196.a1dc2772.js"><link rel="prefetch" href="/assets/js/197.e8905822.js"><link rel="prefetch" href="/assets/js/198.73d65a99.js"><link rel="prefetch" href="/assets/js/199.e20013c6.js"><link rel="prefetch" href="/assets/js/20.b421340a.js"><link rel="prefetch" href="/assets/js/200.c40695bd.js"><link rel="prefetch" href="/assets/js/201.4a211b60.js"><link rel="prefetch" href="/assets/js/202.18d28a26.js"><link rel="prefetch" href="/assets/js/203.27baad27.js"><link rel="prefetch" href="/assets/js/204.a382712d.js"><link rel="prefetch" href="/assets/js/205.e1dc43b7.js"><link rel="prefetch" href="/assets/js/206.44bd5da0.js"><link rel="prefetch" href="/assets/js/207.4db861da.js"><link rel="prefetch" href="/assets/js/208.232fb574.js"><link rel="prefetch" href="/assets/js/209.42950be5.js"><link rel="prefetch" href="/assets/js/21.f95f1c41.js"><link rel="prefetch" href="/assets/js/210.2d10d529.js"><link rel="prefetch" href="/assets/js/211.b16924d3.js"><link rel="prefetch" href="/assets/js/212.a22fdde7.js"><link rel="prefetch" href="/assets/js/213.43351b18.js"><link rel="prefetch" href="/assets/js/214.0b4e4e90.js"><link rel="prefetch" href="/assets/js/215.92066f5f.js"><link rel="prefetch" href="/assets/js/216.2433eee2.js"><link rel="prefetch" href="/assets/js/217.87aa4253.js"><link rel="prefetch" href="/assets/js/218.3e291446.js"><link rel="prefetch" href="/assets/js/219.ba666ae8.js"><link rel="prefetch" href="/assets/js/22.f2f0b7f6.js"><link rel="prefetch" href="/assets/js/220.3dcced4b.js"><link rel="prefetch" href="/assets/js/221.8eff3d5c.js"><link rel="prefetch" href="/assets/js/222.4d16a7ca.js"><link rel="prefetch" href="/assets/js/223.4e3c17c8.js"><link rel="prefetch" href="/assets/js/224.389b19fe.js"><link rel="prefetch" href="/assets/js/225.ee085656.js"><link rel="prefetch" href="/assets/js/226.15bd3b0e.js"><link rel="prefetch" href="/assets/js/227.b12ea50d.js"><link rel="prefetch" href="/assets/js/228.5fe7b89c.js"><link rel="prefetch" href="/assets/js/229.e16a8ad5.js"><link rel="prefetch" href="/assets/js/23.3b332f61.js"><link rel="prefetch" href="/assets/js/230.db0c8438.js"><link rel="prefetch" href="/assets/js/231.9cf35e55.js"><link rel="prefetch" href="/assets/js/232.7bec532c.js"><link rel="prefetch" href="/assets/js/233.6ddb95e4.js"><link rel="prefetch" href="/assets/js/234.2101fb24.js"><link rel="prefetch" href="/assets/js/235.afb383b5.js"><link rel="prefetch" href="/assets/js/236.846b6704.js"><link rel="prefetch" href="/assets/js/237.26987a4d.js"><link rel="prefetch" href="/assets/js/238.e3e59456.js"><link rel="prefetch" href="/assets/js/239.5ea507c1.js"><link rel="prefetch" href="/assets/js/24.f970f639.js"><link rel="prefetch" href="/assets/js/240.766dc0cd.js"><link rel="prefetch" href="/assets/js/241.f91c7b87.js"><link rel="prefetch" href="/assets/js/242.baee8029.js"><link rel="prefetch" href="/assets/js/243.fa7f9b90.js"><link rel="prefetch" href="/assets/js/244.1b536f15.js"><link rel="prefetch" href="/assets/js/245.10355873.js"><link rel="prefetch" href="/assets/js/246.1671ca24.js"><link rel="prefetch" href="/assets/js/247.5acd1cfd.js"><link rel="prefetch" href="/assets/js/248.557b93ba.js"><link rel="prefetch" href="/assets/js/249.6325cda5.js"><link rel="prefetch" href="/assets/js/25.915ccb8b.js"><link rel="prefetch" href="/assets/js/250.2c47b263.js"><link rel="prefetch" href="/assets/js/251.b9915ea2.js"><link rel="prefetch" href="/assets/js/252.1769b4ce.js"><link rel="prefetch" href="/assets/js/253.b3f176b9.js"><link rel="prefetch" href="/assets/js/254.20747e20.js"><link rel="prefetch" href="/assets/js/255.10dd24b0.js"><link rel="prefetch" href="/assets/js/256.77789711.js"><link rel="prefetch" href="/assets/js/257.dfce5065.js"><link rel="prefetch" href="/assets/js/258.20d46398.js"><link rel="prefetch" href="/assets/js/259.7bb7e68d.js"><link rel="prefetch" href="/assets/js/26.6beeb907.js"><link rel="prefetch" href="/assets/js/260.7297cae9.js"><link rel="prefetch" href="/assets/js/261.1864517a.js"><link rel="prefetch" href="/assets/js/263.10d4609c.js"><link rel="prefetch" href="/assets/js/264.ed74db82.js"><link rel="prefetch" href="/assets/js/265.bf0968ee.js"><link rel="prefetch" href="/assets/js/266.aa1f5527.js"><link rel="prefetch" href="/assets/js/267.a60b73d1.js"><link rel="prefetch" href="/assets/js/268.93b88726.js"><link rel="prefetch" href="/assets/js/269.23335c50.js"><link rel="prefetch" href="/assets/js/27.e3d799b8.js"><link rel="prefetch" href="/assets/js/270.cdcc6831.js"><link rel="prefetch" href="/assets/js/271.895326b4.js"><link rel="prefetch" href="/assets/js/272.994f0815.js"><link rel="prefetch" href="/assets/js/273.4b7d1596.js"><link rel="prefetch" href="/assets/js/274.95de5708.js"><link rel="prefetch" href="/assets/js/275.d3f1ea3a.js"><link rel="prefetch" href="/assets/js/276.e523da0d.js"><link rel="prefetch" href="/assets/js/277.cfd44766.js"><link rel="prefetch" href="/assets/js/278.0c433a12.js"><link rel="prefetch" href="/assets/js/279.a1ed8745.js"><link rel="prefetch" href="/assets/js/28.04104649.js"><link rel="prefetch" href="/assets/js/280.3fcf8899.js"><link rel="prefetch" href="/assets/js/281.47c5a007.js"><link rel="prefetch" href="/assets/js/282.ba9f0bde.js"><link rel="prefetch" href="/assets/js/283.adfd31b2.js"><link rel="prefetch" href="/assets/js/284.60b76cd7.js"><link rel="prefetch" href="/assets/js/285.2b3e7c47.js"><link rel="prefetch" href="/assets/js/286.4d559cb5.js"><link rel="prefetch" href="/assets/js/287.20392707.js"><link rel="prefetch" href="/assets/js/288.25ea64b4.js"><link rel="prefetch" href="/assets/js/289.9eed054c.js"><link rel="prefetch" href="/assets/js/29.499f1d39.js"><link rel="prefetch" href="/assets/js/290.9d5b0811.js"><link rel="prefetch" href="/assets/js/291.2968091e.js"><link rel="prefetch" href="/assets/js/292.786f219f.js"><link rel="prefetch" href="/assets/js/293.49fce9ba.js"><link rel="prefetch" href="/assets/js/294.8efa6e84.js"><link rel="prefetch" href="/assets/js/295.2b36b304.js"><link rel="prefetch" href="/assets/js/296.d317e8a1.js"><link rel="prefetch" href="/assets/js/297.ccfd968b.js"><link rel="prefetch" href="/assets/js/298.8163f812.js"><link rel="prefetch" href="/assets/js/299.c36aa0b8.js"><link rel="prefetch" href="/assets/js/3.ec3ff53e.js"><link rel="prefetch" href="/assets/js/30.ffa7e894.js"><link rel="prefetch" href="/assets/js/300.3fdb0d70.js"><link rel="prefetch" href="/assets/js/301.6cb7bd6e.js"><link rel="prefetch" href="/assets/js/302.45daeffe.js"><link rel="prefetch" href="/assets/js/303.100b3d5b.js"><link rel="prefetch" href="/assets/js/304.2019f7cc.js"><link rel="prefetch" href="/assets/js/305.188c6b80.js"><link rel="prefetch" href="/assets/js/306.df056bf9.js"><link rel="prefetch" href="/assets/js/307.4339b90a.js"><link rel="prefetch" href="/assets/js/308.fa360ec4.js"><link rel="prefetch" href="/assets/js/309.f131c986.js"><link rel="prefetch" href="/assets/js/31.72c967d1.js"><link rel="prefetch" href="/assets/js/310.a662fb66.js"><link rel="prefetch" href="/assets/js/311.96067cfa.js"><link rel="prefetch" href="/assets/js/312.b439b634.js"><link rel="prefetch" href="/assets/js/313.aee52801.js"><link rel="prefetch" href="/assets/js/314.326267fc.js"><link rel="prefetch" href="/assets/js/315.19ccdf1b.js"><link rel="prefetch" href="/assets/js/316.1180f907.js"><link rel="prefetch" href="/assets/js/317.2d9d626f.js"><link rel="prefetch" href="/assets/js/318.0edae3ea.js"><link rel="prefetch" href="/assets/js/319.6e587615.js"><link rel="prefetch" href="/assets/js/32.1e042532.js"><link rel="prefetch" href="/assets/js/320.4da94556.js"><link rel="prefetch" href="/assets/js/321.bdf03815.js"><link rel="prefetch" href="/assets/js/322.2e95a194.js"><link rel="prefetch" href="/assets/js/323.6afcc73e.js"><link rel="prefetch" href="/assets/js/324.c7e424e8.js"><link rel="prefetch" href="/assets/js/325.1f5fe5cc.js"><link rel="prefetch" href="/assets/js/326.30472009.js"><link rel="prefetch" href="/assets/js/327.e1a3c701.js"><link rel="prefetch" href="/assets/js/328.8b54cbce.js"><link rel="prefetch" href="/assets/js/329.e437b757.js"><link rel="prefetch" href="/assets/js/33.2071fa71.js"><link rel="prefetch" href="/assets/js/330.23075090.js"><link rel="prefetch" href="/assets/js/331.cb3c8ba2.js"><link rel="prefetch" href="/assets/js/332.d48777dd.js"><link rel="prefetch" href="/assets/js/333.20de85d6.js"><link rel="prefetch" href="/assets/js/334.9aa45eec.js"><link rel="prefetch" href="/assets/js/335.cf061868.js"><link rel="prefetch" href="/assets/js/336.7bdc4422.js"><link rel="prefetch" href="/assets/js/337.4c35c225.js"><link rel="prefetch" href="/assets/js/338.b258f72d.js"><link rel="prefetch" href="/assets/js/339.60b8a4dd.js"><link rel="prefetch" href="/assets/js/34.a8cfe758.js"><link rel="prefetch" href="/assets/js/340.b55b6096.js"><link rel="prefetch" href="/assets/js/341.84aca80e.js"><link rel="prefetch" href="/assets/js/342.9b2f9017.js"><link rel="prefetch" href="/assets/js/343.844f2bc7.js"><link rel="prefetch" href="/assets/js/344.6bb02350.js"><link rel="prefetch" href="/assets/js/345.9c62eaba.js"><link rel="prefetch" href="/assets/js/346.fca463be.js"><link rel="prefetch" href="/assets/js/347.8970fcbf.js"><link rel="prefetch" href="/assets/js/348.a6b83491.js"><link rel="prefetch" href="/assets/js/349.08be2f0b.js"><link rel="prefetch" href="/assets/js/35.cdd41f71.js"><link rel="prefetch" href="/assets/js/350.baf44f92.js"><link rel="prefetch" href="/assets/js/351.2d8a8d39.js"><link rel="prefetch" href="/assets/js/352.f666bb14.js"><link rel="prefetch" href="/assets/js/353.10ece07a.js"><link rel="prefetch" href="/assets/js/354.c6e9ef1f.js"><link rel="prefetch" href="/assets/js/355.40eec06d.js"><link rel="prefetch" href="/assets/js/356.cc2f1b7f.js"><link rel="prefetch" href="/assets/js/357.10e344e1.js"><link rel="prefetch" href="/assets/js/358.5e8d05a0.js"><link rel="prefetch" href="/assets/js/359.2d525223.js"><link rel="prefetch" href="/assets/js/36.919e6ba3.js"><link rel="prefetch" href="/assets/js/360.da8a1144.js"><link rel="prefetch" href="/assets/js/361.1ac300c0.js"><link rel="prefetch" href="/assets/js/362.8701799f.js"><link rel="prefetch" href="/assets/js/363.e46c31c4.js"><link rel="prefetch" href="/assets/js/364.fc6c4a8a.js"><link rel="prefetch" href="/assets/js/365.da925c8b.js"><link rel="prefetch" href="/assets/js/366.fa02c4db.js"><link rel="prefetch" href="/assets/js/367.e84e0fb3.js"><link rel="prefetch" href="/assets/js/368.359d83e3.js"><link rel="prefetch" href="/assets/js/369.58af2f70.js"><link rel="prefetch" href="/assets/js/37.88355974.js"><link rel="prefetch" href="/assets/js/370.66a40ffb.js"><link rel="prefetch" href="/assets/js/371.ee99818a.js"><link rel="prefetch" href="/assets/js/372.5d9079db.js"><link rel="prefetch" href="/assets/js/373.0359fd60.js"><link rel="prefetch" href="/assets/js/374.a4de99b1.js"><link rel="prefetch" href="/assets/js/375.4570b37a.js"><link rel="prefetch" href="/assets/js/376.53476bba.js"><link rel="prefetch" href="/assets/js/377.689818f7.js"><link rel="prefetch" href="/assets/js/378.d89d31af.js"><link rel="prefetch" href="/assets/js/379.fb82d60c.js"><link rel="prefetch" href="/assets/js/38.cad0fc71.js"><link rel="prefetch" href="/assets/js/380.85198566.js"><link rel="prefetch" href="/assets/js/381.ae8317d1.js"><link rel="prefetch" href="/assets/js/382.58c9e741.js"><link rel="prefetch" href="/assets/js/383.ee3fe633.js"><link rel="prefetch" href="/assets/js/384.0a191212.js"><link rel="prefetch" href="/assets/js/385.e3ccc3ad.js"><link rel="prefetch" href="/assets/js/386.22027d7d.js"><link rel="prefetch" href="/assets/js/387.3eeb0716.js"><link rel="prefetch" href="/assets/js/388.5c149843.js"><link rel="prefetch" href="/assets/js/389.9b50d957.js"><link rel="prefetch" href="/assets/js/39.24010b8d.js"><link rel="prefetch" href="/assets/js/390.39b1f5ff.js"><link rel="prefetch" href="/assets/js/391.cbcda5c9.js"><link rel="prefetch" href="/assets/js/392.f995f59f.js"><link rel="prefetch" href="/assets/js/393.2f75984b.js"><link rel="prefetch" href="/assets/js/394.ea7f3774.js"><link rel="prefetch" href="/assets/js/395.4f424dee.js"><link rel="prefetch" href="/assets/js/396.c76bc489.js"><link rel="prefetch" href="/assets/js/397.8a1b2cc3.js"><link rel="prefetch" href="/assets/js/398.42e064e4.js"><link rel="prefetch" href="/assets/js/399.16f3d435.js"><link rel="prefetch" href="/assets/js/4.93ec791c.js"><link rel="prefetch" href="/assets/js/40.bd3d9a39.js"><link rel="prefetch" href="/assets/js/400.3440cb4b.js"><link rel="prefetch" href="/assets/js/401.827b23b9.js"><link rel="prefetch" href="/assets/js/402.c6a70840.js"><link rel="prefetch" href="/assets/js/403.dc8d0f36.js"><link rel="prefetch" href="/assets/js/404.05a4374e.js"><link rel="prefetch" href="/assets/js/405.3c45c89c.js"><link rel="prefetch" href="/assets/js/406.66d1d0f4.js"><link rel="prefetch" href="/assets/js/407.a0518bda.js"><link rel="prefetch" href="/assets/js/408.0056dad8.js"><link rel="prefetch" href="/assets/js/409.1f9aefa6.js"><link rel="prefetch" href="/assets/js/41.9e141a4f.js"><link rel="prefetch" href="/assets/js/410.a35b5300.js"><link rel="prefetch" href="/assets/js/411.bc9650d2.js"><link rel="prefetch" href="/assets/js/412.e00f104b.js"><link rel="prefetch" href="/assets/js/413.25ef56c5.js"><link rel="prefetch" href="/assets/js/414.cdaa11bd.js"><link rel="prefetch" href="/assets/js/415.cce2a856.js"><link rel="prefetch" href="/assets/js/416.fa9934bd.js"><link rel="prefetch" href="/assets/js/417.500f47ea.js"><link rel="prefetch" href="/assets/js/418.2ef6f6ba.js"><link rel="prefetch" href="/assets/js/419.ec8571b4.js"><link rel="prefetch" href="/assets/js/42.d492b5aa.js"><link rel="prefetch" href="/assets/js/420.be2674a7.js"><link rel="prefetch" href="/assets/js/421.d7bb6384.js"><link rel="prefetch" href="/assets/js/422.8749a7a6.js"><link rel="prefetch" href="/assets/js/423.418f421a.js"><link rel="prefetch" href="/assets/js/424.9ba49f0f.js"><link rel="prefetch" href="/assets/js/425.2f1bc2f7.js"><link rel="prefetch" href="/assets/js/426.e0af5b96.js"><link rel="prefetch" href="/assets/js/427.4f00c4a0.js"><link rel="prefetch" href="/assets/js/43.9a0ca836.js"><link rel="prefetch" href="/assets/js/44.ac3652d4.js"><link rel="prefetch" href="/assets/js/45.2d07d148.js"><link rel="prefetch" href="/assets/js/46.0c2866e6.js"><link rel="prefetch" href="/assets/js/47.cf37ad71.js"><link rel="prefetch" href="/assets/js/48.74897468.js"><link rel="prefetch" href="/assets/js/49.f6cefa1d.js"><link rel="prefetch" href="/assets/js/5.112a4da8.js"><link rel="prefetch" href="/assets/js/50.6adecd4c.js"><link rel="prefetch" href="/assets/js/51.0f539ecd.js"><link rel="prefetch" href="/assets/js/52.ff2d24a2.js"><link rel="prefetch" href="/assets/js/53.41f9aecc.js"><link rel="prefetch" href="/assets/js/54.9986979d.js"><link rel="prefetch" href="/assets/js/55.c3bf2fc5.js"><link rel="prefetch" href="/assets/js/56.ca9f6c28.js"><link rel="prefetch" href="/assets/js/57.699610a3.js"><link rel="prefetch" href="/assets/js/58.dc7773de.js"><link rel="prefetch" href="/assets/js/59.b85736ff.js"><link rel="prefetch" href="/assets/js/6.3e921c42.js"><link rel="prefetch" href="/assets/js/60.f1003898.js"><link rel="prefetch" href="/assets/js/61.c4c403f4.js"><link rel="prefetch" href="/assets/js/62.ed8e50a5.js"><link rel="prefetch" href="/assets/js/63.64cd3fee.js"><link rel="prefetch" href="/assets/js/64.e388d5ae.js"><link rel="prefetch" href="/assets/js/65.29951343.js"><link rel="prefetch" href="/assets/js/66.1ea4ad87.js"><link rel="prefetch" href="/assets/js/67.463a27f8.js"><link rel="prefetch" href="/assets/js/68.88e8b422.js"><link rel="prefetch" href="/assets/js/69.ce1b84b3.js"><link rel="prefetch" href="/assets/js/7.5c268975.js"><link rel="prefetch" href="/assets/js/70.551c5f52.js"><link rel="prefetch" href="/assets/js/71.cd36811b.js"><link rel="prefetch" href="/assets/js/72.1b96650f.js"><link rel="prefetch" href="/assets/js/73.736d3bfe.js"><link rel="prefetch" href="/assets/js/74.96ff3fac.js"><link rel="prefetch" href="/assets/js/75.84d8a749.js"><link rel="prefetch" href="/assets/js/76.fac6e027.js"><link rel="prefetch" href="/assets/js/77.4f2d1524.js"><link rel="prefetch" href="/assets/js/78.aa8c1ca1.js"><link rel="prefetch" href="/assets/js/79.c31601c8.js"><link rel="prefetch" href="/assets/js/8.a4eb93a7.js"><link rel="prefetch" href="/assets/js/80.3139181d.js"><link rel="prefetch" href="/assets/js/81.614abe85.js"><link rel="prefetch" href="/assets/js/82.2d806c4d.js"><link rel="prefetch" href="/assets/js/83.537cd6eb.js"><link rel="prefetch" href="/assets/js/84.8be49118.js"><link rel="prefetch" href="/assets/js/85.eab92218.js"><link rel="prefetch" href="/assets/js/86.30bf9928.js"><link rel="prefetch" href="/assets/js/87.d4db1c81.js"><link rel="prefetch" href="/assets/js/88.1d9ff3df.js"><link rel="prefetch" href="/assets/js/89.21115247.js"><link rel="prefetch" href="/assets/js/9.c513f608.js"><link rel="prefetch" href="/assets/js/90.ade9e720.js"><link rel="prefetch" href="/assets/js/91.b4fdf18b.js"><link rel="prefetch" href="/assets/js/92.53aaea7d.js"><link rel="prefetch" href="/assets/js/93.0b954340.js"><link rel="prefetch" href="/assets/js/94.1e64c3b0.js"><link rel="prefetch" href="/assets/js/95.6a103dc3.js"><link rel="prefetch" href="/assets/js/96.716744ae.js"><link rel="prefetch" href="/assets/js/97.25459d09.js"><link rel="prefetch" href="/assets/js/98.b6c42c9e.js"><link rel="prefetch" href="/assets/js/99.b87bc26a.js">
    <link rel="stylesheet" href="/assets/css/0.styles.f47fbc3a.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">hemiao3000</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工具库" class="dropdown-title"><span class="title">工具库</span> <span class="arrow down"></span></button> <button type="button" aria-label="工具库" class="mobile-dropdown-title"><span class="title">工具库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/utility/spring-utils/01-top4.html" class="nav-link">
  Spring 内置工具库
</a></li><li class="dropdown-item"><!----> <a href="/utility/guava/01-字符串工具类.html" class="nav-link">
  Guava 工具库
</a></li><li class="dropdown-item"><!----> <a href="/utility/3rd/01-slf4j.html" class="nav-link">
  其它工具库
</a></li><li class="dropdown-item"><!----> <a href="/gist/01-jdbc.html" class="nav-link">
  各种模板
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="第一阶段" class="dropdown-title"><span class="title">第一阶段</span> <span class="arrow down"></span></button> <button type="button" aria-label="第一阶段" class="mobile-dropdown-title"><span class="title">第一阶段</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/java/01-Java语法汇总.html" class="nav-link">
  Java
</a></li><li class="dropdown-item"><!----> <a href="/java-thread/01-base.html" class="nav-link">
  Java 多线程
</a></li><li class="dropdown-item"><!----> <a href="/java8/02-lambda.html" class="nav-link">
  JDK8 新特性
</a></li><li class="dropdown-item"><!----> <a href="/mysql/01-操作Database.html" class="nav-link">
  MySQL 数据库
</a></li><li class="dropdown-item"><!----> <a href="/jdbc/01-JDBC基础.html" class="nav-link">
  JDBC 操作数据库
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="第二阶段" class="dropdown-title"><span class="title">第二阶段</span> <span class="arrow down"></span></button> <button type="button" aria-label="第二阶段" class="mobile-dropdown-title"><span class="title">第二阶段</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/html/01-基本概念和结构.html" class="nav-link">
  HTML
</a></li><li class="dropdown-item"><!----> <a href="/css/01-基本概念.html" class="nav-link">
  CSS
</a></li><li class="dropdown-item"><!----> <a href="/js/01-基础.html" class="nav-link">
  JavaScript
</a></li><li class="dropdown-item"><!----> <a href="/servlet/00-HTTP概述.html" class="nav-link">
  Servlet
</a></li><li class="dropdown-item"><!----> <a href="/junit/01-基础.html" class="nav-link">
  JUnit
</a></li><li class="dropdown-item"><!----> <a href="/mybatis/01-basics.html" class="nav-link">
  Mybatis
</a></li><li class="dropdown-item"><!----> <a href="/ajax/01-基础.html" class="nav-link">
  AJAX 请求及相关
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="第三阶段" class="dropdown-title"><span class="title">第三阶段</span> <span class="arrow down"></span></button> <button type="button" aria-label="第三阶段" class="mobile-dropdown-title"><span class="title">第三阶段</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/maven/001-基本概念.html" class="nav-link">
  Maven
</a></li><li class="dropdown-item"><!----> <a href="/spring/01-IoC.html" class="nav-link">
  Spring
</a></li><li class="dropdown-item"><!----> <a href="/spring-mvc/001-helloworld.html" class="nav-link">
  Spring MVC
</a></li><li class="dropdown-item"><!----> <a href="/spring-boot/02-Java代码配置.html" class="nav-link">
  Spring Boot
</a></li><li class="dropdown-item"><!----> <a href="/shiro/01-基础.html" class="nav-link">
  Shiro
</a></li><li class="dropdown-item"><!----> <a href="/restful/01-基础.html" class="nav-link">
  RESTful API
</a></li><li class="dropdown-item"><!----> <a href="/vue/vue-00-devtool.html" class="nav-link">
  Vue（上）
</a></li><li class="dropdown-item"><!----> <a href="/vue-cli/vue-cli-01.html" class="nav-link">
  Vue（下）
</a></li><li class="dropdown-item"><!----> <a href="/nginx/01-前后端分离.html" class="nav-link">
  Nginx
</a></li><li class="dropdown-item"><!----> <a href="/redis/01-简介.html" class="nav-link">
  Redis
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="第四阶段" class="dropdown-title"><span class="title">第四阶段</span> <span class="arrow down"></span></button> <button type="button" aria-label="第四阶段" class="mobile-dropdown-title"><span class="title">第四阶段</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/spring-cloud/00-拆分和restTemplate.html" class="nav-link">
  Spring Cloud
</a></li><li class="dropdown-item"><!----> <a href="/rabbitmq/01-简介.html" class="nav-link">
  RabbitMQ
</a></li><li class="dropdown-item"><!----> <a href="/es/00-素材.html" class="nav-link">
  ElasticSearch
</a></li><li class="dropdown-item"><!----> <a href="/spring-data-jpa/01.基本概念.html" class="nav-link">
  Spring Data JPA
</a></li><li class="dropdown-item"><!----> <a href="/other/01-SnowFlake.html" class="nav-link">
  其它
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="开发环境和软件安装" class="dropdown-title"><span class="title">开发环境和软件安装</span> <span class="arrow down"></span></button> <button type="button" aria-label="开发环境和软件安装" class="mobile-dropdown-title"><span class="title">开发环境和软件安装</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/windows/01-IDEA.html" class="nav-link">
  Windows
</a></li><li class="dropdown-item"><!----> <a href="/linux/00-预备知识.html" class="nav-link">
  Linux
</a></li><li class="dropdown-item"><!----> <a href="/git/000-安装与配置.html" class="nav-link">
  Git
</a></li><li class="dropdown-item"><!----> <a href="/docker/01-简介和安装.html" class="nav-link">
  Docker
</a></li><li class="dropdown-item"><!----> <a href="/docker-install/01-mysql.html" class="nav-link">
  Docker 安装软件
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="面试复习" class="dropdown-title"><span class="title">面试复习</span> <span class="arrow down"></span></button> <button type="button" aria-label="面试复习" class="mobile-dropdown-title"><span class="title">面试复习</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/jvm/01-JVM内存布局.html" class="nav-link">
  Java 虚拟机
</a></li><li class="dropdown-item"><!----> <a href="/interview-questions/01-ArraySort.html" class="nav-link">
  面试题专题
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工具库" class="dropdown-title"><span class="title">工具库</span> <span class="arrow down"></span></button> <button type="button" aria-label="工具库" class="mobile-dropdown-title"><span class="title">工具库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/utility/spring-utils/01-top4.html" class="nav-link">
  Spring 内置工具库
</a></li><li class="dropdown-item"><!----> <a href="/utility/guava/01-字符串工具类.html" class="nav-link">
  Guava 工具库
</a></li><li class="dropdown-item"><!----> <a href="/utility/3rd/01-slf4j.html" class="nav-link">
  其它工具库
</a></li><li class="dropdown-item"><!----> <a href="/gist/01-jdbc.html" class="nav-link">
  各种模板
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="第一阶段" class="dropdown-title"><span class="title">第一阶段</span> <span class="arrow down"></span></button> <button type="button" aria-label="第一阶段" class="mobile-dropdown-title"><span class="title">第一阶段</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/java/01-Java语法汇总.html" class="nav-link">
  Java
</a></li><li class="dropdown-item"><!----> <a href="/java-thread/01-base.html" class="nav-link">
  Java 多线程
</a></li><li class="dropdown-item"><!----> <a href="/java8/02-lambda.html" class="nav-link">
  JDK8 新特性
</a></li><li class="dropdown-item"><!----> <a href="/mysql/01-操作Database.html" class="nav-link">
  MySQL 数据库
</a></li><li class="dropdown-item"><!----> <a href="/jdbc/01-JDBC基础.html" class="nav-link">
  JDBC 操作数据库
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="第二阶段" class="dropdown-title"><span class="title">第二阶段</span> <span class="arrow down"></span></button> <button type="button" aria-label="第二阶段" class="mobile-dropdown-title"><span class="title">第二阶段</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/html/01-基本概念和结构.html" class="nav-link">
  HTML
</a></li><li class="dropdown-item"><!----> <a href="/css/01-基本概念.html" class="nav-link">
  CSS
</a></li><li class="dropdown-item"><!----> <a href="/js/01-基础.html" class="nav-link">
  JavaScript
</a></li><li class="dropdown-item"><!----> <a href="/servlet/00-HTTP概述.html" class="nav-link">
  Servlet
</a></li><li class="dropdown-item"><!----> <a href="/junit/01-基础.html" class="nav-link">
  JUnit
</a></li><li class="dropdown-item"><!----> <a href="/mybatis/01-basics.html" class="nav-link">
  Mybatis
</a></li><li class="dropdown-item"><!----> <a href="/ajax/01-基础.html" class="nav-link">
  AJAX 请求及相关
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="第三阶段" class="dropdown-title"><span class="title">第三阶段</span> <span class="arrow down"></span></button> <button type="button" aria-label="第三阶段" class="mobile-dropdown-title"><span class="title">第三阶段</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/maven/001-基本概念.html" class="nav-link">
  Maven
</a></li><li class="dropdown-item"><!----> <a href="/spring/01-IoC.html" class="nav-link">
  Spring
</a></li><li class="dropdown-item"><!----> <a href="/spring-mvc/001-helloworld.html" class="nav-link">
  Spring MVC
</a></li><li class="dropdown-item"><!----> <a href="/spring-boot/02-Java代码配置.html" class="nav-link">
  Spring Boot
</a></li><li class="dropdown-item"><!----> <a href="/shiro/01-基础.html" class="nav-link">
  Shiro
</a></li><li class="dropdown-item"><!----> <a href="/restful/01-基础.html" class="nav-link">
  RESTful API
</a></li><li class="dropdown-item"><!----> <a href="/vue/vue-00-devtool.html" class="nav-link">
  Vue（上）
</a></li><li class="dropdown-item"><!----> <a href="/vue-cli/vue-cli-01.html" class="nav-link">
  Vue（下）
</a></li><li class="dropdown-item"><!----> <a href="/nginx/01-前后端分离.html" class="nav-link">
  Nginx
</a></li><li class="dropdown-item"><!----> <a href="/redis/01-简介.html" class="nav-link">
  Redis
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="第四阶段" class="dropdown-title"><span class="title">第四阶段</span> <span class="arrow down"></span></button> <button type="button" aria-label="第四阶段" class="mobile-dropdown-title"><span class="title">第四阶段</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/spring-cloud/00-拆分和restTemplate.html" class="nav-link">
  Spring Cloud
</a></li><li class="dropdown-item"><!----> <a href="/rabbitmq/01-简介.html" class="nav-link">
  RabbitMQ
</a></li><li class="dropdown-item"><!----> <a href="/es/00-素材.html" class="nav-link">
  ElasticSearch
</a></li><li class="dropdown-item"><!----> <a href="/spring-data-jpa/01.基本概念.html" class="nav-link">
  Spring Data JPA
</a></li><li class="dropdown-item"><!----> <a href="/other/01-SnowFlake.html" class="nav-link">
  其它
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="开发环境和软件安装" class="dropdown-title"><span class="title">开发环境和软件安装</span> <span class="arrow down"></span></button> <button type="button" aria-label="开发环境和软件安装" class="mobile-dropdown-title"><span class="title">开发环境和软件安装</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/windows/01-IDEA.html" class="nav-link">
  Windows
</a></li><li class="dropdown-item"><!----> <a href="/linux/00-预备知识.html" class="nav-link">
  Linux
</a></li><li class="dropdown-item"><!----> <a href="/git/000-安装与配置.html" class="nav-link">
  Git
</a></li><li class="dropdown-item"><!----> <a href="/docker/01-简介和安装.html" class="nav-link">
  Docker
</a></li><li class="dropdown-item"><!----> <a href="/docker-install/01-mysql.html" class="nav-link">
  Docker 安装软件
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="面试复习" class="dropdown-title"><span class="title">面试复习</span> <span class="arrow down"></span></button> <button type="button" aria-label="面试复习" class="mobile-dropdown-title"><span class="title">面试复习</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/jvm/01-JVM内存布局.html" class="nav-link">
  Java 虚拟机
</a></li><li class="dropdown-item"><!----> <a href="/interview-questions/01-ArraySort.html" class="nav-link">
  面试题专题
</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Spring Boot</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/spring-boot/02-Java代码配置.html" class="sidebar-link">Spring 的 Java 代码配置</a></li><li><a href="/spring-boot/01-基础.html" class="sidebar-link">Spring Boot 基础</a></li><li><a href="/spring-boot/03-自动配置.html" class="sidebar-link">Spring Boot 自动配置</a></li><li><a href="/spring-boot/04-spring-boot-jsp.html" class="sidebar-link">Spring Boot 中使用 JSP</a></li><li><a href="/spring-boot/05-thymeleaf基础.html" class="sidebar-link">Spring Boot 中使用 Thymeleaf</a></li><li><a href="/spring-boot/81-spring-boot-jdbc.html" class="sidebar-link">Spring Boot 中使用 Spring JDBC</a></li><li><a href="/spring-boot/06-spring-boot-mybatis.html" class="sidebar-link">Spring Boot 中使用 MyBatis</a></li><li><a href="/spring-boot/15-spring-profiles-active.html" class="sidebar-link">Spring Boot 的多配置文件</a></li><li><a href="/spring-boot/11-spring-task.html" class="sidebar-link">Spring Task 定时任务</a></li><li><a href="/spring-boot/12-spring-boot-mail.html" class="sidebar-link">Spring Boot 中发送邮件</a></li><li><a href="/spring-boot/13-spring-boot-swagger.html" class="sidebar-link">Swagger</a></li><li><a href="/spring-boot/14-spring-boot-actuator.html" class="sidebar-link">使用 Spring Boot Actuator 监控应用</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="spring-data-jpa-的高级使用"><a href="#spring-data-jpa-的高级使用" class="header-anchor">#</a> Spring Data JPA 的高级使用</h1> <h2 id="关系映射"><a href="#关系映射" class="header-anchor">#</a> 关系映射</h2> <h3 id="被省略调的默认设置"><a href="#被省略调的默认设置" class="header-anchor">#</a> 被省略调的默认设置</h3> <p>由于 JPA 的默认设置在起作用，我们之前对 <strong><code>@Entity</code></strong> 中的属性的设置，『有些注解被省略掉了』。</p> <ul><li><p>与主键列对应的属性，除了使用 <strong><code>@Id</code></strong> 注解，还要使用 <strong><code>@Column</code></strong> 注解。<small>（<strong><code>@GeneratedValue</code></strong> 注解的作用是另一码事，和我们这里说的无关）</small></p></li> <li><p>与其它列对应的属性，除了使用 <strong><code>@Basic</code></strong> 注解，还要使用 <strong><code>@Column</code></strong> 注解。</p></li></ul> <p>完整的形式应该如下：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Entity</span>
<span class="token annotation punctuation">@Table</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;department&quot;</span><span class="token punctuation">,</span> schema <span class="token operator">=</span> <span class="token string">&quot;scott&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Department</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Id</span>
    <span class="token annotation punctuation">@Column</span>
    <span class="token annotation punctuation">@GeneratedValue</span><span class="token punctuation">(</span>strategy <span class="token operator">=</span> <span class="token class-name">GenerationType</span><span class="token punctuation">.</span>IDENTITY<span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> id<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Basic</span>
    <span class="token annotation punctuation">@Column</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Basic</span>
    <span class="token annotation punctuation">@Column</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> location<span class="token punctuation">;</span>

    <span class="token comment">// getter / setter</span>
<span class="token punctuation">}</span>
</code></pre></div><p>这里【默认】的规则如下：</p> <ul><li><p>Entity 的属性默认就是 <strong><code>@Basic</code></strong>。因此，逻辑上是 <strong><code>@Basic</code></strong> 的属性头上的 <strong><code>@Basic</code></strong> 就都可以省略。不是 <strong><code>@Basic</code></strong> 的属性，例如 <strong><code>@Id</code></strong>，自然就要明确标明 <strong><code>@Id</code></strong>。</p></li> <li><p>如果属性名和列名是一致的，或只是驼峰命名法和下划线命名法这种命名风格的差异，那么，<strong><code>@Column</code></strong> 注解可以省略。反而言之，<strong><code>@Column</code></strong> 注解只有在双方命名不一致的情况下，才会出来干活。</p></li></ul> <h3 id="一对多关系映射-配置"><a href="#一对多关系映射-配置" class="header-anchor">#</a> 一对多关系映射/配置</h3> <p>这里有个概念可以便于理解和记忆以下配置：<strong><strong><code>JoinColumn</code></strong> 指的就是外键列</strong>，只不过一个是编程领域中的叫法，一个是数据库领域中的叫法。<strong><code>@JoinColumn</code></strong> 的 <strong><code>name</code></strong> 自然就是外键列的列名。</p> <p>如果没有映射成【引用】关系，那么 Entity 中的与外键列对应的属性，使用的注解自然就是 <strong><code>@Basic</code></strong> + <strong><code>@Column</code></strong>。例如：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Basic</span>
<span class="token annotation punctuation">@Column</span>
<span class="token keyword">private</span> <span class="token class-name">Integer</span> departmentId<span class="token punctuation">;</span>
</code></pre></div><p>当 <strong><code>Integer departmentId</code></strong> 属性要衍变为 <strong><code>Department department</code></strong> 属性时，自然不再适合使用 <strong><code>@Basic</code></strong> + <strong><code>@Column</code></strong> 注解。</p> <p>在一对多的关系中：</p> <ul><li><p>在多方<small>（例如员工、学生）</small>的属性上，使用 <strong><code>@ManyToOne</code></strong> + <strong><code>@JoinColumn</code></strong> 注解。</p></li> <li><p>在一方<small>（例如部门、老师）</small>的属性上，使用 <strong><code>@OneToMany</code></strong> 注解。</p></li></ul> <p>需要注意的是，<strong><code>@ManyToOne</code></strong> 和 <strong><code>@OneToMany</code></strong> 两个注解并非必须成对出现，只有在双向的关系中，一方和多方需要互相引用对象时，才会成对出现。如果是单向的关系，通常只是对多方使用 <strong><code>@ManyToOne</code></strong> 。</p> <ul><li><p>Employee 类</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@ManyToOne</span>
<span class="token annotation punctuation">@JoinColumn</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;department_id&quot;</span><span class="token punctuation">)</span>  <span class="token comment">// 外键列列名字</span>
</code></pre></div></li></ul> <p>private Department department;</p> <div class="language- extra-class"><pre class="language-text"><code>
-   Department
``` java
@OneToMany(mappedBy = &quot;department&quot;) // 对应对端的相关属性名。
private Set&lt;Employee&gt; employeeSet;  // 可以使用 List
</code></pre></div><p>另外，需要强调的是，由于在一对多关系中，外键列是在『<strong>从表</strong>』一方。也就是『<strong>多方</strong>』。因此，是【多方】的配置中出现 <strong><code>@JoinColumn</code></strong>。如果是双向关系的话，主表方/一方使用 <strong><code>mappedBy</code></strong> 。</p> <ul><li><p>通用形式：</p> <div class="language-java extra-class"><pre class="language-java"><code>多方<span class="token operator">/</span>从表方 <span class="token operator">:</span> <span class="token class-name">Employee</span> <span class="token punctuation">{</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token annotation punctuation">@ManyToOne</span>
    <span class="token annotation punctuation">@JoinColumn</span><span class="token punctuation">(</span>
	    name <span class="token operator">=</span> <span class="token string">&quot;外键列 name（这一列是在从表中的）&quot;</span><span class="token punctuation">,</span>
	    referencedColumnName<span class="token operator">=</span><span class="token string">&quot;与外键列对应的列 name（通常是主表的主键列）&quot;</span>
    <span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Department</span> department<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

一方<span class="token operator">/</span>主表方 <span class="token operator">:</span> <span class="token class-name">Department</span> <span class="token punctuation">{</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token annotation punctuation">@OneToMany</span><span class="token punctuation">(</span>mappedBy<span class="token operator">=</span><span class="token string">&quot;对端对应的属性的 name（就是用上了 @ManyToOne 的那个属性）&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Employee</span><span class="token punctuation">&gt;</span></span> employeeSet<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ul> <h3 id="一对多双向关系的注意事项"><a href="#一对多双向关系的注意事项" class="header-anchor">#</a> 一对多双向关系的注意事项</h3> <blockquote><p>再次强调，如无必要，尽量不要使用双向关系。</p></blockquote> <ol><li><p>在『<strong>多方</strong>』 <strong><code>@ManyToOne</code></strong> 中要使用 <strong><code>FetchType.LAZY</code></strong>，否则会导致性能降低（1 + N 问题）。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">class</span> <span class="token class-name">Employee</span> <span class="token punctuation">{</span>
  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
  <span class="token annotation punctuation">@ManyToOne</span><span class="token punctuation">(</span>fetch <span class="token operator">=</span> <span class="token class-name">FetchType</span><span class="token punctuation">.</span>LAZY<span class="token punctuation">)</span>
  <span class="token annotation punctuation">@JoinColumn</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;department_id&quot;</span><span class="token punctuation">)</span>
  <span class="token keyword">private</span> <span class="token class-name">Department</span> department<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>『<strong>一方</strong>』中要增加了 2 个方法，***<code>.addXxx()</code>*** 和 <em><strong><code>.removeXxx()</code></strong></em> 。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">class</span> <span class="token class-name">Department</span> <span class="token punctuation">{</span>
  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addEmployee</span><span class="token punctuation">(</span><span class="token class-name">Employee</span> employee<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>employeeSet<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>employee<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>

    employeeSet<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>employee<span class="token punctuation">)</span><span class="token punctuation">;</span>
    employee<span class="token punctuation">.</span><span class="token function">setDepartment</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">removeEmployee</span><span class="token punctuation">(</span><span class="token class-name">Employee</span> employee<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>employeeSet<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>employee<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>

    employeeSet<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>employee<span class="token punctuation">)</span><span class="token punctuation">;</span>
    employee<span class="token punctuation">.</span><span class="token function">setDepartment</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>『<strong>多方</strong>』中的 <em><code>.setXxx()</code></em> 方法要重新设计。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">class</span> <span class="token class-name">Employee</span> <span class="token punctuation">{</span>
  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setDepartment</span><span class="token punctuation">(</span><span class="token class-name">Department</span> department<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>department <span class="token operator">==</span> department<span class="token punctuation">)</span>
      <span class="token keyword">return</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>department <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>department<span class="token punctuation">.</span><span class="token function">removeEmployee</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">this</span><span class="token punctuation">.</span>department <span class="token operator">=</span> department<span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>department <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
      department<span class="token punctuation">.</span><span class="token function">addEmployee</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ol> <div class="language- extra-class"><pre class="language-text"><code>
4.  在使用 JSON 来序列化对象或生成默认的 *`toString()`* 方法时，会产生无限递归&lt;small&gt;（Infinite recursion）&lt;/small&gt;问题：StackOverFlow。

再次强调一点，&lt;span clss=&quot;strong&quot;&gt;最理想的情况应该是【有向无环】&lt;/strong&gt;。如非必要，尽量不要使用双向关系。因为一不小心容易出现逻辑错误。


### 多对多关系映射/配置


这里有个无关的小问题，由于下面的例子中使用到的素材里有个表名为 **`order`**，这与数据库关键字冲突，因此为了【告知】Hibernate/JPA 在【帮】我们执行 SQL 语句时要为它加返单引号，因此在 Entity 的 **`@Table`** 中做一点小改动：

``` java
@Table(name = &quot;`order`&quot;, schema = &quot;scott&quot;)
</code></pre></div><p>如果充分理解 <strong><code>@ManyToOne</code></strong>，那么接下来理解多对多关系中的 <strong><code>@ManyToMany</code></strong> 就很容易。</p> <p>Order 类：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@ManyToMany</span>
<span class="token annotation punctuation">@JoinTable</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;orderitem&quot;</span><span class="token punctuation">,</span>  <span class="token comment">// 指定中间表</span>
    joinColumns <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token annotation punctuation">@JoinColumn</span><span class="token punctuation">(</span>      <span class="token comment">// 【我】（Order）是如何和中间表关联</span>
        name <span class="token operator">=</span> <span class="token string">&quot;order_id&quot;</span><span class="token punctuation">,</span>           <span class="token comment">// 中间表中的对应我的主键列的外键列</span>
        referencedColumnName <span class="token operator">=</span> <span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span> <span class="token comment">// 【我】的主键列</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    inverseJoinColumns <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token annotation punctuation">@JoinColumn</span><span class="token punctuation">(</span> <span class="token comment">// 【我的对端】（Product）是如何和中间表关联</span>
        name <span class="token operator">=</span> <span class="token string">&quot;prod_id&quot;</span><span class="token punctuation">,</span>              <span class="token comment">// 中间表中的对应我的对端的主键列的外键列</span>
        referencedColumnName <span class="token operator">=</span> <span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span>   <span class="token comment">// 【我的对端】的主键列</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">)</span>
<span class="token keyword">private</span> <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Product</span><span class="token punctuation">&gt;</span></span> productSet<span class="token punctuation">;</span>
</code></pre></div><p>由于多对多的关系中，<strong>外键列</strong> 是在中间表中（A B 并没有对方的外键列），因此 <strong><code>@JoinColumn</code></strong> 自然是出现在 <strong><code>@JoinTable</code></strong> 【里面】的。并且，<strong><code>@JoinColumn</code></strong> 的 <strong><code>name</code></strong> 指的就是外键列的列名。</p> <p>!FILENAME Product</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@ManyToMany</span><span class="token punctuation">(</span>mappedBy <span class="token operator">=</span> <span class="token string">&quot;productSet&quot;</span><span class="token punctuation">)</span>  <span class="token comment">// 对端的对应属性名</span>
<span class="token keyword">private</span> <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Order</span><span class="token punctuation">&gt;</span></span> orderSet<span class="token punctuation">;</span>
</code></pre></div><p><strong>一对多双向关系中需要关注的那几点，在多对多双向关系中一样也要关注！</strong></p> <ul><li><p>通用形式：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">A</span>方 <span class="token operator">:</span> <span class="token class-name">Order</span> <span class="token punctuation">{</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token annotation punctuation">@ManyToMany</span>
    <span class="token annotation punctuation">@JoinTable</span><span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">&quot;中间表name&quot;</span><span class="token punctuation">,</span>
  	  joinColumns <span class="token operator">=</span> <span class="token punctuation">{</span> 	<span class="token comment">// 配置【我】（A方）与中间表的关系</span>
  		  <span class="token annotation punctuation">@JoinColumn</span><span class="token punctuation">(</span>
  			  name <span class="token operator">=</span> <span class="token string">&quot;中间表中A方的外键列name&quot;</span><span class="token punctuation">,</span>
  			  referencedColumnName <span class="token operator">=</span> <span class="token string">&quot;A方表中与之对应的列的name（通常就是A方的主键列）&quot;</span>
  		  <span class="token punctuation">)</span>
  	  <span class="token punctuation">}</span>
  	  inverseJoinColumns <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token comment">// 配置【对方】（B方）与中间表的关系</span>
  		  <span class="token annotation punctuation">@JoinColumn</span><span class="token punctuation">(</span>
  			  name <span class="token operator">=</span> <span class="token string">&quot;中间表中B方的外键列name&quot;</span><span class="token punctuation">,</span>
  			  referencedColumnName <span class="token operator">=</span> <span class="token string">&quot;B方表中与之对应的列的name（通常就是B方的主键列）&quot;</span>
  		  <span class="token punctuation">)</span>
  	  <span class="token punctuation">}</span>
    <span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Product</span><span class="token punctuation">&gt;</span></span> productSet<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token class-name">B</span>方 <span class="token operator">:</span> <span class="token class-name">Product</span> <span class="token punctuation">{</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

    <span class="token annotation punctuation">@ManyToMany</span><span class="token punctuation">(</span>mappedBy<span class="token operator">=</span><span class="token string">&quot;对方用上了@ManyToMany和@JoinTable写了一大坨配置的那个属性的name&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Order</span><span class="token punctuation">&gt;</span></span> orderSet<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ul> <h3 id="一对一关系映射-配置"><a href="#一对一关系映射-配置" class="header-anchor">#</a> 一对一关系映射/配置</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">class</span> <span class="token class-name">Product</span> <span class="token punctuation">{</span> <span class="token comment">// 主表</span>
  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

  <span class="token annotation punctuation">@OneToOne</span><span class="token punctuation">(</span>mappedBy<span class="token operator">=</span><span class="token string">&quot;product&quot;</span><span class="token punctuation">)</span>
  <span class="token keyword">private</span> <span class="token class-name">Productnote</span> productnote<span class="token punctuation">;</span>
  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">class</span> <span class="token class-name">Productnote</span> <span class="token punctuation">{</span>
  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
  <span class="token annotation punctuation">@OneToOne</span><span class="token punctuation">(</span>optional <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
  <span class="token annotation punctuation">@JoinColumn</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;prod_id&quot;</span><span class="token punctuation">)</span> <span class="token comment">// 外键列</span>
  <span class="token keyword">private</span> <span class="token class-name">Product</span> product<span class="token punctuation">;</span>
  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre></div><p>上面用到的 <em><code>optional</code></em> 并非必须，这里只是故意显示其作用。optional 的默认值为 true，在 <strong><code>@ManyToOne</code></strong> 和 <strong><code>@ManyToMany</code></strong> 中也可使用。</p> <p>当 optional 的属性值为 true 时，Hibernate/JPA 执行的是内连（inner join）查询，因此 product 属性值必定null null 。为 false 时，Hibernate/JPA 执行的是左外连接（left join）查询，因此 product 属性的值有可能为 null （是否真为 null，取决于数据库的实际情况）。</p> <ul><li><p>通用形式</p> <div class="language-java extra-class"><pre class="language-java"><code>主表 <span class="token operator">:</span> <span class="token class-name">Product</span> <span class="token punctuation">{</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token annotation punctuation">@OneToOne</span><span class="token punctuation">(</span>mappedBy<span class="token operator">=</span><span class="token string">&quot;从表方用上了 @OneToOne 和 @JoinColumn 的那个属性的name&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">ProductNode</span> node<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

从表 <span class="token operator">:</span> <span class="token class-name">ProductNote</span> <span class="token punctuation">{</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token annotation punctuation">@OneToOne</span>
    <span class="token annotation punctuation">@JoinColumn</span><span class="token punctuation">(</span>
  	  name<span class="token operator">=</span><span class="token string">&quot;外键列name（这一列肯定是在从表中的）&quot;</span><span class="token punctuation">,</span>
  	  referencedColumnName<span class="token operator">=</span><span class="token string">&quot;与外键列对应的列name（通常是主表的主键列）&quot;</span>
    <span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Product</span> product<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ul> <h2 id="分页、排序、限制查询"><a href="#分页、排序、限制查询" class="header-anchor">#</a> 分页、排序、限制查询</h2> <p>Spring Data JPA 已经帮我们内置了分页功能，在查询的方法中，需要传入参数 Pageable，当查询中有多个参数的时候 Pageable 建议 <em><strong>作为最后一个参数传入</strong></em>。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// Pageable pageable = PageRequest.of(0, 3);</span>
<span class="token class-name">Page</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> <span class="token function">findByNickNameAndEmail</span><span class="token punctuation">(</span><span class="token class-name">String</span> nickName<span class="token punctuation">,</span> <span class="token class-name">String</span> email<span class="token punctuation">,</span> <span class="token class-name">Pageable</span> pageable<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>具有分页功能的方法会返回一个 <strong><code>Page&lt;T&gt;</code></strong> 对象，其中封装了与分页有关的相关信息，及其所获取的数据。</p> <p>Pageable 是 Spring 封装的分页实现类，使用的时候需要传入页数、每页条数和排序规则，Page 是 Spring 封装的分页对象，封装了总页数、分页数据等。返回对象除使用 Page 外，还可以使用 Slice 作为返回值。</p> <p>Page 和 Slice 的区别如下:</p> <ul><li><p>Page 接口继承自 Slice 接口，而 Slice 继承自 Iterable 接口。</p></li> <li><p>Page 接口扩展了 Slice 接口，添加了获取总页数和元素总数量的方法，因此，返回 Page 接口时，必须执行两条 SQL，一条复杂查询分页数据，另一条负责统计数据数量。</p></li> <li><p>返回 Slice 结果时，查询的 SQL 只会有查询分页数据这一条，不统计数据数量。</p></li> <li><p>用途不一样：Slice 不需要知道总页数、总数据量，只需要知道是否有下一页、上一页，是否是首页、尾页等，比如前端滑动加载一页可用；而 Page 知道总页数、总数据量，可以用于展示具体的页数信息，比如后台分页查询。</p></li></ul> <p>实例：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testPageQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> page<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> size<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">;</span>
    <span class="token class-name">Sort</span> sort <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Sort</span><span class="token punctuation">(</span><span class="token class-name">Sort<span class="token punctuation">.</span>Direction</span><span class="token punctuation">.</span>DESC<span class="token punctuation">,</span> <span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 排序</span>
    <span class="token class-name">Pageable</span> pageable <span class="token operator">=</span> <span class="token class-name">PageRequest</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>page<span class="token punctuation">,</span> size<span class="token punctuation">,</span> sort<span class="token punctuation">)</span><span class="token punctuation">;</span>
    userRepository<span class="token punctuation">.</span><span class="token function">findALL</span><span class="token punctuation">(</span>pageable<span class="token punctuation">)</span><span class="token punctuation">;</span>
    userRepository<span class="token punctuation">.</span><span class="token function">findByNickName</span><span class="token punctuation">(</span><span class="token string">&quot;aa&quot;</span><span class="token punctuation">,</span> pageable<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li><p>Sort，控制分页数据的排序，可以选择升序和降序。</p></li> <li><p>PageRequest，控制分页的辅助类，可以设置页码、每页的数据条数、排序等。</p></li></ul> <h3 id="限制查询-docsify-ignore"><a href="#限制查询-docsify-ignore" class="header-anchor">#</a> 限制查询 {docsify-ignore}</h3> <p>有时候我们只需要查询前 N 个元素，或者只取前一个实体。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// order by salary</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Employee</span><span class="token punctuation">&gt;</span></span> <span class="token function">findFirstByOrderBySalary</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 

<span class="token comment">// order by salary desc limit 2</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Employee</span><span class="token punctuation">&gt;</span></span> <span class="token function">findFirst2ByOrderBySalaryDesc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// where job = ? order by salary desc limit 2 </span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Employee</span><span class="token punctuation">&gt;</span></span> <span class="token function">findFirst2ByJobEqualsOrderBySalaryDesc</span><span class="token punctuation">(</span><span class="token class-name">String</span> job<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="更复杂的条件查询"><a href="#更复杂的条件查询" class="header-anchor">#</a> 更复杂的条件查询</h2> <p>我们可以通过 <strong><code>AND</code></strong> 或者 <strong><code>OR</code></strong> 等连接词来不断拼接属性来构建多条件查询，但如果参数大于 6 个时，方法名就会变得非常的长，并且还不能解决动态多条件查询的场景。到这里就需要给大家介绍另外一个利器 <strong><code>JpaSpecificationExecutor</code></strong> 了。</p> <p><code>JpaSpecificationExecutor</code> 是 JPA 2.0 提供的 <strong><code>Criteria API</code></strong> 的使用封装，可以用于动态生成 Query 来满足我们业务中的各种复杂场景。我们只需要为我们的自定义接口多继承一个父接口：<code>JpaSpecificationExecutor</code> 。</p> <ul><li><p>我们的自定义的接口多继承了 <code>JpaSpecificationExecutor</code> 后，我们的接口中自然就【多】出来一些入参为 <strong><code>Specification</code></strong> 类型的方法。</p></li> <li><p><code>Specification</code> 是一个接口，其中的 <strong><code>toPredicate</code></strong> 方法的返回值 <strong><code>Predicate</code></strong> 对象就代表着查询条件。</p></li> <li><p>简单来说，我们要去实现 <code>Specification</code> 接口，并通过实现它的 <code>toPredicate</code> 方法返回一个 <code>Predicate</code> 对象。<code>JpaSpecificationExecutor</code> 需要这个 <code>Predicate</code> 对象来执行查询操作。</p></li></ul> <p>在使用 JpaSpecificationExecutor 构建复杂查询场景之前，我们需要了解几个概念：</p> <table><thead><tr><th style="text-align:left;">概念</th> <th style="text-align:left;">说明</th></tr></thead> <tbody><tr><td style="text-align:left;"><code>Root&lt;T&gt; root</code></td> <td style="text-align:left;">代表了可以查询和操作的实体对象的根，可以通过 <code>get(&quot;属性名&quot;)</code> 来获取对应的值。</td></tr> <tr><td style="text-align:left;"><code>CriteriaQuery&lt;?&gt; query</code></td> <td style="text-align:left;">代表一个 <code>specific</code> 的顶层查询对象，它包含着查询的各个部分，比如 <code>select</code>、<code>from</code>、<code>where</code>、<code>group by</code>、<code>order by</code> 等。</td></tr> <tr><td style="text-align:left;"><code>CriteriaBuilder cb</code></td> <td style="text-align:left;">来构建 <code>CritiaQuery</code> 的构建器器对象，其实就相当于条件或者是条件组合，并以 <code>Predicate</code> 的形式返回。</td></tr></tbody></table> <h3 id="使用案例"><a href="#使用案例" class="header-anchor">#</a> 使用案例</h3> <ul><li><p>为 <code>EmployeeRepository</code> 【多】添加接口：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Repository</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">EmployeeRepository</span> <span class="token keyword">extends</span>
      <span class="token class-name">JpaRepository</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Employee</span><span class="token punctuation">,</span> <span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">,</span>
      <span class="token class-name">JpaSpecificationExecutor</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Employee</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
          <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>在 Service（或 Junit）中使用 JpaSpecificationExecutor 的具体使用。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// 1. Specification 的 toPredicate() 方法返回的 Predicate 对象负责描述【要找的人的标准】。</span>
<span class="token class-name">Specification</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Employee</span><span class="token punctuation">&gt;</span></span> specification <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Specification</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token annotation punctuation">@Override</span>
  <span class="token keyword">public</span> <span class="token class-name">Predicate</span> <span class="token function">toPredicate</span><span class="token punctuation">(</span><span class="token class-name">Root</span> root<span class="token punctuation">,</span> <span class="token class-name">CriteriaQuery</span> query<span class="token punctuation">,</span> <span class="token class-name">CriteriaBuilder</span> criteriaBuilder<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Predicate</span> predicate1 <span class="token operator">=</span> criteriaBuilder<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span>root<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;job&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;SALESMAN&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Predicate</span> predicate2 <span class="token operator">=</span> criteriaBuilder<span class="token punctuation">.</span><span class="token function">greaterThan</span><span class="token punctuation">(</span>root<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;salary&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Predicate</span> predicate3 <span class="token operator">=</span> criteriaBuilder<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span>root<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;job&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;MANAGER&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Predicate</span> predicate4 <span class="token operator">=</span> criteriaBuilder<span class="token punctuation">.</span><span class="token function">lessThan</span><span class="token punctuation">(</span>root<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;salary&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">25000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Predicate</span> predicate5 <span class="token operator">=</span> criteriaBuilder<span class="token punctuation">.</span><span class="token function">like</span><span class="token punctuation">(</span>root<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;A%&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">/*
     * where (job = 'SALESMAN' and salary &gt; 1000) 
     *   or (job = 'MANAGER' and sal &lt; 2500) 
     *   or name like 'A%'
     */</span>
    <span class="token keyword">return</span> criteriaBuilder<span class="token punctuation">.</span><span class="token function">or</span><span class="token punctuation">(</span>
      criteriaBuilder<span class="token punctuation">.</span><span class="token function">and</span><span class="token punctuation">(</span>predicate1<span class="token punctuation">,</span> predicate2<span class="token punctuation">)</span><span class="token punctuation">,</span>
      criteriaBuilder<span class="token punctuation">.</span><span class="token function">and</span><span class="token punctuation">(</span>predicate3<span class="token punctuation">,</span> predicate4<span class="token punctuation">)</span><span class="token punctuation">,</span>
      predicate5
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 2. findAll() 负责干【找人】这个活。</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Employee</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> repository<span class="token punctuation">.</span><span class="token function">findAll</span><span class="token punctuation">(</span>specification<span class="token punctuation">)</span><span class="token punctuation">;</span>

list<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token operator">::</span><span class="token function">println</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li></ul> <p>JpaSpecificationExecutor 接口中的方法也支持分页和排序等功能。</p> <h2 id="jpa-高级查询-qbc-自学、了解"><a href="#jpa-高级查询-qbc-自学、了解" class="header-anchor">#</a> JPA 高级查询：QBC（自学、了解）</h2> <h3 id="query"><a href="#query" class="header-anchor">#</a> @Query</h3> <p>使用 Spring Data 大部分的 SQL 都可以根据方法名定义的方式来实现，但是由于某些原因必须使用自定义的 SQL 来查询，Spring Data 也可以完美支持。</p> <p>在 SQL 的查询方法上面使用 <em><strong><code>@Query</code></strong></em> 注解，在注解内写 Hql 来查询内容。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Query</span><span class="token punctuation">(</span><span class="token string">&quot;select e from Employee e where e.job = ?1&quot;</span><span class="token punctuation">)</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Employee</span><span class="token punctuation">&gt;</span></span> <span class="token function">xxx</span><span class="token punctuation">(</span><span class="token class-name">String</span> job<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Query</span><span class="token punctuation">(</span><span class="token string">&quot;select e from Employee e where e.job = :hello&quot;</span><span class="token punctuation">)</span>
<span class="token class-name">Page</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Employee</span><span class="token punctuation">&gt;</span></span> <span class="token function">yyy</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">&quot;hello&quot;</span><span class="token punctuation">)</span> <span class="token class-name">String</span> job<span class="token punctuation">,</span> <span class="token class-name">Pageable</span> pageable<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>当然如果感觉使用原生 SQL 更习惯，它也是支持的，需要再添加一个参数 <em><code>nativeQuery = true</code></em> 。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Query</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;select * from employee where job = ?1&quot;</span><span class="token punctuation">,</span> nativeQuery <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
<span class="token class-name">Page</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Employee</span><span class="token punctuation">&gt;</span></span> <span class="token function">zzz</span><span class="token punctuation">(</span><span class="token class-name">String</span> job<span class="token punctuation">,</span> <span class="token class-name">Pageable</span> pageable<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="qbc-多表查询"><a href="#qbc-多表查询" class="header-anchor">#</a> QBC 多表查询</h3> <p>多表查询在 Spring Data JPA 中有两种实现方式：</p> <ol><li>利用 Hibernate 的级联查询来实现；</li> <li>是创建一个结果集的接口来接收连表查询后的结果。</li></ol> <p>这里主要介绍第二种方式。</p> <p>定义一个结果集的<span class="strong">接口</span>，接口的内容来自于员工表和部门表。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">EmployeeInfo</span> <span class="token punctuation">{</span>
    <span class="token class-name">Integer</span> <span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> <span class="token function">getJob</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Integer</span> <span class="token function">getSalary</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Integer</span> <span class="token function">getDepartmentId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> <span class="token function">getDepartmentName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> <span class="token function">getDepartmentLocation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>在运行中 Spring 会给接口（EmployeeInfo）自动生产一个代理类来接收返回的结果，代码中使用 <code>getXXX()</code> 的形式来获取。</p> <p>在 <strong><code>EmployeeRepository</code></strong> 中添加查询的方法，返回类型设置为 UserInfo：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Query</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;select e.id as id,&quot;</span> <span class="token operator">+</span>
        <span class="token string">&quot; e.name as name,&quot;</span> <span class="token operator">+</span>
        <span class="token string">&quot; e.job as job,&quot;</span> <span class="token operator">+</span>
        <span class="token string">&quot; e.salary as salary,&quot;</span> <span class="token operator">+</span>
        <span class="token string">&quot; e.departmentId as departmentId,&quot;</span> <span class="token operator">+</span>
        <span class="token string">&quot; d.name as departmentName,&quot;</span> <span class="token operator">+</span>
        <span class="token string">&quot; d.location as departmentLocation&quot;</span> <span class="token operator">+</span>
        <span class="token string">&quot; from Employee e, Department d&quot;</span> <span class="token operator">+</span>
        <span class="token string">&quot; where e.departmentId = d.id and e.job = ?1&quot;</span><span class="token punctuation">)</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">EmployeeInfo</span><span class="token punctuation">&gt;</span></span> <span class="token function">findEmployeeInfo</span><span class="token punctuation">(</span><span class="token class-name">String</span> job<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>特别注意这里的 SQL 是 HQL，需要写类的名和属性，这块很容易出错。</p> <ul><li><p>测试验证：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">EmployeeInfo</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> repository<span class="token punctuation">.</span><span class="token function">findEmployeeInfo</span><span class="token punctuation">(</span><span class="token string">&quot;SALESMAN&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
list<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>info <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
  <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>info<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;, &quot;</span> <span class="token operator">+</span> info<span class="token punctuation">.</span><span class="token function">getDepartmentName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li></ul> <h2 id="open-session-in-view"><a href="#open-session-in-view" class="header-anchor">#</a> open session in view</h2> <p><span class="strong">因为延迟加载</span>，你有可能在执行代码时，发现报如下错误。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>hibernate<span class="token punctuation">.</span></span>LazyInitializationException</span><span class="token operator">:</span> could not initialize proxy <span class="token punctuation">[</span><span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>softeem<span class="token punctuation">.</span>bean<span class="token punctuation">.</span>po<span class="token punctuation">.</span></span>Employee</span>#<span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">-</span> no <span class="token class-name">Session</span>
	at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>hibernate<span class="token punctuation">.</span>proxy<span class="token punctuation">.</span></span>AbstractLazyInitializer</span><span class="token punctuation">.</span><span class="token function">initialize</span><span class="token punctuation">(</span><span class="token class-name">AbstractLazyInitializer</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">169</span><span class="token punctuation">)</span> <span class="token operator">~</span><span class="token punctuation">[</span>hibernate<span class="token operator">-</span>core<span class="token operator">-</span><span class="token number">5.3</span><span class="token number">.15</span><span class="token punctuation">.</span>Final<span class="token punctuation">.</span>jar<span class="token operator">:</span><span class="token number">5.3</span><span class="token number">.15</span><span class="token punctuation">.</span>Final<span class="token punctuation">]</span>
	at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>hibernate<span class="token punctuation">.</span>proxy<span class="token punctuation">.</span></span>AbstractLazyInitializer</span><span class="token punctuation">.</span><span class="token function">getImplementation</span><span class="token punctuation">(</span><span class="token class-name">AbstractLazyInitializer</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">309</span><span class="token punctuation">)</span> <span class="token operator">~</span><span class="token punctuation">[</span>hibernate<span class="token operator">-</span>core<span class="token operator">-</span><span class="token number">5.3</span><span class="token number">.15</span><span class="token punctuation">.</span>Final<span class="token punctuation">.</span>jar<span class="token operator">:</span><span class="token number">5.3</span><span class="token number">.15</span><span class="token punctuation">.</span>Final<span class="token punctuation">]</span>
	at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>hibernate<span class="token punctuation">.</span>proxy<span class="token punctuation">.</span>pojo<span class="token punctuation">.</span>bytebuddy<span class="token punctuation">.</span></span>ByteBuddyInterceptor</span><span class="token punctuation">.</span><span class="token function">intercept</span><span class="token punctuation">(</span><span class="token class-name">ByteBuddyInterceptor</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">45</span><span class="token punctuation">)</span> <span class="token operator">~</span><span class="token punctuation">[</span>hibernate<span class="token operator">-</span>core<span class="token operator">-</span><span class="token number">5.3</span><span class="token number">.15</span><span class="token punctuation">.</span>Final<span class="token punctuation">.</span>jar<span class="token operator">:</span><span class="token number">5.3</span><span class="token number">.15</span><span class="token punctuation">.</span>Final<span class="token punctuation">]</span>
	at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>hibernate<span class="token punctuation">.</span>proxy<span class="token punctuation">.</span></span>ProxyConfiguration</span>$<span class="token class-name">InterceptorDispatcher</span><span class="token punctuation">.</span><span class="token function">intercept</span><span class="token punctuation">(</span><span class="token class-name">ProxyConfiguration</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">95</span><span class="token punctuation">)</span> <span class="token operator">~</span><span class="token punctuation">[</span>hibernate<span class="token operator">-</span>core<span class="token operator">-</span><span class="token number">5.3</span><span class="token number">.15</span><span class="token punctuation">.</span>Final<span class="token punctuation">.</span>jar<span class="token operator">:</span><span class="token number">5.3</span><span class="token number">.15</span><span class="token punctuation">.</span>Final<span class="token punctuation">]</span>
</code></pre></div><p>例如，去查询一个员工信息，在 Service 层向 Web 层返回 Employee 对象后，去打印员工的部门的名字。</p> <blockquote><p>不过，在 Spring Boot 中看到这个问题并不是很容易，因为，Spring Boot 的默认配置启用了 <em><code>opne-session-in-view</code></em> 功能，解决了这个问题。因此，你需要将这个功能关掉，才能看到这个错。</p> <p>关闭的方法是：在配置文件中添加配置：spring.jpa.open-in-view=false 。很显然，这个配置项的默认值是 true 。</p></blockquote> <p>出现这个问题的原因在于，当 Service 层的方法执行结束返回 Employee 对象时，与数据库之间的连接已经断开。因为延迟加载的原因，当 Web 层因为 <em><code>.getDepartment()</code></em> 而导致需要查询 Department 时，自然就没有连接/会话来支持这个操作的执行。</p> <blockquote><p>从 Hibernate 的角度解释是，Employee 对象已经从持久态变为游离态，此时，无法再通过 Employee 对象去查询相关的 Department 对象了。</p></blockquote> <p><em><code>open-session-in-view</code></em> 功能本质上就是延迟 session 的关闭，将原本在 Service 层结束时就该关闭的 Session，推迟到 Web 层结束时再关闭。因此，在 Web 层的方法中，你触发延迟加载时，仍有 session 可用，以支持背后的自动的查询行为。</p> <p>启用 <em><code>open-session-in-view</code></em> 功能需要进行两步配置。不过这里 Spring Boot 都【帮】我们干完了。</p> <p>启动类<small>（或某个配置类）</small>中加入</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">OpenEntityManagerInViewFilter</span> <span class="token function">openEntityManagerInViewFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">OpenEntityManagerInViewFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>配置文件中加入 <em><code>spring.jpa.open-in-view=true</code></em> 。</p> <h2 id="entity-对象转-json-时的一个异常"><a href="#entity-对象转-json-时的一个异常" class="header-anchor">#</a> @Entity 对象转 JSON 时的一个异常</h2> <p>在 RESTful 风格的项目中，当 Web 层将 Service 层返回的 Entity 对象转换成 JSON 格式字符串时，有可能会报如下错误:</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>fasterxml<span class="token punctuation">.</span>jackson<span class="token punctuation">.</span>databind<span class="token punctuation">.</span>exc<span class="token punctuation">.</span></span>InvalidDefinitionException</span><span class="token operator">:</span> <span class="token class-name">No</span> serializer found <span class="token keyword">for</span> <span class="token keyword">class</span> <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>hibernate<span class="token punctuation">.</span>proxy<span class="token punctuation">.</span>pojo<span class="token punctuation">.</span>bytebuddy<span class="token punctuation">.</span></span>ByteBuddyInterceptor</span> and no properties discovered <span class="token keyword">to</span> <span class="token namespace">create</span> <span class="token class-name">BeanSerializer</span> <span class="token punctuation">(</span><span class="token keyword">to</span> <span class="token namespace">avoid</span> exception<span class="token punctuation">,</span> disable <span class="token class-name">SerializationFeature</span><span class="token punctuation">.</span>FAIL_ON_EMPTY_BEANS<span class="token punctuation">)</span> <span class="token punctuation">(</span>through reference chain<span class="token operator">:</span> <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>childdream<span class="token punctuation">.</span>price<span class="token punctuation">.</span>entity<span class="token punctuation">.</span></span>Price</span>$<span class="token class-name">HibernateProxy</span>$<span class="token class-name">FGboGgyG</span><span class="token punctuation">[</span><span class="token string">&quot;hibernateLazyInitializer&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
</code></pre></div><p>直接分析原因的话，是因为 jackson 库在将 Entity 序列化为 JSON 格式字符串时，发现其中有一个名为 <code>hibernateLazyInitializer</code> 为 null 。这种情况许下下，jackson 不知道该如何处理这个属性，因此它就抛出异常抱错。</p> <p>但是，问题是我们的 Entity 中好似并没有 <code>hibernateLazyInitializer</code> 属性!</p> <p>这里的关键还是也延迟加载有关。实际上 Hibernate 并未真的去直接使用我们的 Entity，而是利用类似于 AOP 代理机制，去创建并使用了 Entity 的代理对象。从 Service 层返回到 Web 层的并不是真正的 Entity 对象，而是 Entity 的代理对象。</p> <p>Entity 的代理对象中有这个 <code>hibernateLazyInitializer</code> 属性！</p> <p>解决掉这个异常有两种办法：</p> <ol><li><p>在 Entity 的头上标注 <code>@JsonIgnoreProperties(value = {&quot;hibernateLazyInitializer&quot;})</code> 。</p> <p>实际上就是在告诉 jackson，去序列化 Entity 时忽略调其中的 <code>hibernateLazyInitializer</code> 属性。</p></li> <li><p>在 Spring Boot 配置文件中配置 <code>spring.jackson.serialization.FAIL_ON_EMPTY_BEANS=false</code> 。</p> <p>这是在告诉 jackson，去序列化对象时，如果遇到为 null 的属性不要抛出异常，而是继续序列化。</p> <p>这种情况下，Web 层返回给前端的 JSON 数据中会多一项：<code>hibernateLazyInitializer=&quot;&quot;</code> 。</p></li></ol> <p>『The End』</p></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.2a0e0086.js" defer></script><script src="/assets/js/2.5197d4bf.js" defer></script><script src="/assets/js/262.5d7edfe0.js" defer></script>
  </body>
</html>
